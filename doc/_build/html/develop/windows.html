<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Windows下开发环境的搭建 &mdash; Zephyr-CN 0.0.1 文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="使用vscode进行Zephyr应用开发" href="vscode.html" />
    <link rel="prev" title="面向物联网时代的新一代嵌入式软件平台Zephyr" href="../introduction/overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Zephyr-CN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">内容:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">面向物联网时代的新一代嵌入式软件平台Zephyr</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Windows下开发环境的搭建</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">准备代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">工具链</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">主机工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">设置环境变量以及必要配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zephyr">编译Zephyr应用</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vscode.html">使用vscode进行Zephyr应用开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="write_doc.html">如何贡献文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">开发者参考</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zephyr-CN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Windows下开发环境的搭建</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/develop/windows.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="windows">
<span id="develop-windows"></span><h1>Windows下开发环境的搭建<a class="headerlink" href="#windows" title="永久链接至标题">¶</a></h1>
<p>新一代的IoT OS平台相对以往的RTOS平台更加复杂，需要许多不同的工具， Zephyr也是如此。Zephyr当前支持在Windows、Linux、Mac OS下的构建，
其中Linux下的支持最好，按照Zephyr官方文档一步一步操作即可。Zephyr对Windows支持是基于 <a class="reference external" href="https://chocolatey.org/">Chocolatey</a>
包管理器，但对于国内用户而言，可能存在两大问题， 第一Chocolatey包管理器安装需要特殊设置，可能无法安装;第二即使安装好后，由于chocolatey
在国内并没有镜像源，下载软件包的速度会很不稳定。</p>
<p>本章主要介绍一种适合国内用户的替代方案。</p>
<section id="id1">
<h2>准备代码<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>Zephyr的代码可以分为Zephyr OS和Zephyr modules两大部分，都托管在github上。经过多年的发展，整个Zephyr的代码已经相当庞大，如果对github
的访问不可靠的话，那么在第一次准备代码时会存在问题。有鉴于此，SIG-Zephyr提供了基于Zephyr发行版的代码镜像，以方便国内用户访问：</p>
<blockquote>
<div><ul class="simple">
<li><p>只包含Zephyr OS最新发行版和lts发行版，可以访问 <a class="reference external" href="https://gitee.com/src-openeuler/zephyr">镜像</a></p></li>
<li><p>包含了Zephyr OS和Zephyr modules，可以访问 <a class="reference external" href="https://pan.baidu.com/s/1v6wk386WMKZ8X8cXSdfUOQ">网盘</a> 提取码: <strong>zeph</strong></p></li>
<li><p>如果需要同步Zephyr OS的git仓库，可以先通过 <a class="reference external" href="https://gitee.com/zephyr-rtos/zephyr">gitee镜像</a> 同步，然后再同步到github上
的仓库</p></li>
<li><p>Zephyr modules数量较多，但只有部分git仓库在 <a class="reference external" href="https://gitee.com/zephyr-rtos">gitee镜像</a> 上存在，缺失的部分需要通过其方式
获得。在实际开发过程中，很少会使用到所有Zephyr modules, 因此可以根据需要，只准备相应的modules。</p></li>
</ul>
</div></blockquote>
<p>下载或clone好代码后，一种推荐的文件布局如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;顶层目录zephyr_workspace&gt;
├── bootloader  bootloader模块，目前只有mcuboot
├── modules     zephyr modules顶层目录，其下包含各种modules
├── tools       zephyr配套的工具目录
└── zephyr      zephyr OS核心目录（必要)
</pre></div>
</div>
</section>
<section id="id5">
<h2>工具链<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>Zephyr SDK</p></li>
</ul>
<p>Zephyr Project自身提供了一个包含编译器、QEMU仿真器、openOCD调试等工具在内的SDK(Software Development Kit)， 称之为Zephyr SDK。
通过维护Zephyr SDK，Zephyr Project提供了一个完整的解决方案，无须再安装其他工具。同时，Zephyr SDK与Zephyr OS共同演进发布，并且经过
测试，很好地解决了工具与OS的兼容性问题。一般情况下，最新版本的Zephyr SDK配套最新版本的Zephyr, 用户可以通过如下链接获取Zephyr SDK:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/zephyrproject-rtos/sdk-ng/releases">Zephyr SDK</a></p>
</div></blockquote>
<p>Zephyr SDK中的编译器是基于GCC的，包含Zephyr支持的所有处理器架构，因此完整的SDK自解压安装包大于1 GB。用户也可以选择只包含所用到处理器架构
编译器的SDK安装包，大约在100-200 MB之间。</p>
<p>Zephyr SDK是发布在github上， 国内访问速度比较慢且不稳定，SIG-Zephyr也提供了基于百度网盘的最新SDK镜像：</p>
<blockquote>
<div><p><a class="reference external" href="https://pan.baidu.com/s/1v6wk386WMKZ8X8cXSdfUOQ">最新版Zephyr SDK镜像</a> 提取码: <strong>zeph</strong></p>
</div></blockquote>
<p>当前Zephyr SDK是基于Yocto构建的，因此只支持Linux环境。Zephyr SDK正计划迁移到基于 <a class="reference external" href="https://crosstool-ng.github.io/">cross-ng</a> 的构建，
届时为会Windows，Linux和MAC OS构建出相应的工具链。如果有兴趣尝试，可以通过链接获取原型：</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/zephyrproject-rtos/sdk-ng-testing/releases">下一代Zephyr SDK原型</a></p>
</div></blockquote>
<ul class="simple">
<li><p>GNU ARM Embedded工具链</p></li>
</ul>
<p>如前文所述，Zephyr SDK暂不支持Windows环境，需要使用第三方的工具链，对于ARM 32位架构硬件（ARM Cortex M系列， ARM Cortex R系列等）推荐使用
GNU ARM Embedded工具链：</p>
<blockquote>
<div><p><a class="reference external" href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm">Windows GNU ARM Embedded工具链</a></p>
</div></blockquote>
<p>假设下载后并安装在 <code class="file docutils literal notranslate"><span class="pre">C:\gnu_arm_embedded</span></code> 下。</p>
</section>
<section id="id8">
<h2>主机工具<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>下载好编译器之后，接下来是准备主机工具。Zephyr对主机工具的最小依赖如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>工具名</p></th>
<th class="head"><p>最低版本</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://cmake.org/">CMake</a></p></td>
<td><p>3.20.0</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.python.org/">Python</a></p></td>
<td><p>3.6</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.devicetree.org/">Devicetree compiler</a></p></td>
<td><p>1.4.6</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/ninja-build/ninja/releases/download/v1.10.2/ninja-win.zip">ninja</a></p></td>
<td><p>1.10.2 (windows需要)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.gnu.org/software/gperf/">gperf</a></p></td>
<td><p>3.1</p></td>
</tr>
</tbody>
</table>
<p>上述工具中，CMAKE、Python和ninja都有windows版本，请下载、安装并添加到Windows的PATH路径。DTC和gperf是gnu工具，并没有
直接的windows发行版本，而是基于cygwin或msys2环境实现Windows下的运行，例如Chocolatey中的gperf和dtc是其实也是基于msys2
环境。</p>
<ul class="simple">
<li><p>安装msys2的pacman包管理器</p></li>
</ul>
<p>由于Chocolatey的限制，此处我们使用另一个 <a class="reference external" href="https://www.msys2.org">msys2</a> 提供的包管理器pacman来实现gperf和msys2的
安装。基于msys2的pacman管理器，国内有大量的镜像源且安装方便，不存在类似Chocolatey的问题。 此处使用清华源：</p>
<blockquote>
<div><blockquote>
<div><p><a class="reference external" href="https://mirrors.tuna.tsinghua.edu.cn/help/msys2/">pacman安装包清华源</a></p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>安装好后，请更新相应的镜像源地址，尽可能使用国内的镜像源以加速访问，如阿里云，清华，中科大等</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p>安装dtc和gperf</p></li>
</ul>
<p>打开msys2命令行窗口，安装dtc和gperf</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pacman -R dtc gperf
</pre></div>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>我们只需要dtc和gperf，不要安装其他个工具， 由于msys2环境的路径问题，cmake, python, ninja可能存在着不
兼容的问题</p>
</div>
</div></blockquote>
<ul class="simple">
<li><p>安装west</p></li>
</ul>
<p>Zephyr的开发并不是必须依赖west, 但通过west可以有效简化一些步骤，因此我们推荐安装west。</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3  install -U west
</pre></div>
</div>
</div></blockquote>
<p>west的初始化依赖git, 所以请同时安装好Windows git。</p>
<ul class="simple">
<li><p>安装QEMU</p></li>
</ul>
<p>体验Zephyr并不需要有实际的开发板，可以通过QEMU来模拟相应的开发板。</p>
<blockquote>
<div><p><a class="reference external" href="https://qemu.weilnetz.de/w64/2021/qemu-w64-setup-20211215.exe">QEMU 6.2 windows版</a></p>
</div></blockquote>
</section>
<section id="id9">
<h2>设置环境变量以及必要配置<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>Windows的PATH变量：需要把python, cmake, ninja以及msys2的 “&lt;msys2安装目录&gt;usrbin”添加到Windows PATH变量中。
设置好之后，打开cmd窗口，如能找python, cmake, ninja, dtc， gperf， git, qemu-system-arm这些命令，则为成功。</p></li>
<li><p>安装所需要的python库：</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --user -r &lt;zephyr workspace目录&gt;/zephyr/scripts/requirements.txt
</pre></div>
</div>
<ul class="simple">
<li><p>为GNU ARM Embedded工具链设置环境变量,在Windows增加了两个环境变量:</p>
<ul>
<li><p>“ZEPHYR_TOOLCHAIN_VARIANT”值为“gnuarmemb”， 告知Zephyr构建系统使用的是GNU ARM Embedded工具链</p></li>
<li><p>“GNUARMEMB_TOOLCHAIN_PATH”值为:file:<cite>C:\gnu_arm_embedded</cite>, 即GNU ARM Embedded安装目录</p></li>
</ul>
</li>
<li><p>初始化Zephyr workspace</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;zephyr workspace目录&gt;
west init -l zephyr <span class="c1">#通过 -l参数，实现workspace本地初始化</span>
west zephyr-export  <span class="c1">#导出CMake FindPackages</span>
</pre></div>
</div>
</section>
<section id="zephyr">
<h2>编译Zephyr应用<a class="headerlink" href="#zephyr" title="永久链接至标题">¶</a></h2>
<p>上述所有准备工作完成之后，可以尝试构建Zephyr应用了。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> &lt;zephyr workspace目录&gt;/zephyr
west build -p auto -b qemu_cortex_m3 samples/philosophers <span class="c1"># 编译zephyr应用</span>
west build -t run <span class="c1"># 通过qemu运行zephyr应用</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../introduction/overview.html" class="btn btn-neutral float-left" title="面向物联网时代的新一代嵌入式软件平台Zephyr" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vscode.html" class="btn btn-neutral float-right" title="使用vscode进行Zephyr应用开发" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2021, SIG-Zephyr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>